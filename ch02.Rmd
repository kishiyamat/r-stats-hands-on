---
title: "母集団と標本"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!--
目的
- 仮説検証時のツッコミを経験し、計画の大切さを説明できる
- 手元のデータから母集団に関して言及するために必要なズレを説明できる
-->

## 2.1 母集団と標本の関係

> 教訓: データの選択（サンプリング）で「本当のデータ」からはズレる。
> 本当のデータを取得できない現実で本当の値(平均や分散)の議論を進めるためには
> 手元のデータから本当の平均値ズレを推定したい。

Ch01では以下の教訓があったが、これを教科書(p.10)に沿った言い方に変えると...

> **母集団**の性質（**母平均**、**母分散**）を**標本**から**推定**
> (統計の三大目的)したい

となる。**太字**の用語は抑えておきましょう。これらの推定ができると
本当のデータを取得できない現実での議論を進められる、ということになります。
その際、標本(サンプル)の取得方法に関して
**ランダムサンプリング**と**トレードオフ**の話もしてくれています。

なお、母集団と標本の性質を分けてか表記したいとき、
母平均を$\mu$、母分散を $\sigma^2$ と表記します。
対して標本(母集団の性質を推定するためのデータ)
の標本平均を $\bar{X}$、標本分散 を $s^2$ と表記します。

## 2.2 標本の性質

p.13以降は徐々に数式が増えていくのでRのコードで補足していきます。
データは以下のように準備できます。

```{r}
# <- で値を代入、 cはconcatenateのcなので、カッコ内を平にする。
A <- c(3, 4, 4, 5, 5, 5, 5, 6, 6, 7)
B <- c(1, 2, 4, 4, 5, 5, 5, 6, 8, 10)
# repはrepeatなので、 rep("SampleA", 10) の意味は...?
df1 <- data.frame(
  values = c(A, B),
  labels = c(rep("SampleA", 10), rep("SampleB", 10))
)
# 最初の6行を見せて、という意味
head(df1, 6)
```
このデータは以下のように可視化できます。

```{r}
library(ggplot2)
ggplot(df1) +
  facet_wrap(. ~ labels) +
  geom_histogram(aes(x = values))
```

データを触れるようになったところで、2.2.1に移りましょう。
SampleAもSampleBも5あたりに中心があるけれど、
ばらつきはSampleBの方が大きいですね。
```{r}
# https://whatalnk.github.io/stat-intro-by-r-tkd/Chap02.html
A <- c(
  43.3, 43.1, 42.6, 42.4, 42.2, 41.8, 41.7, 41.6, 41.5, 41.4,
  40.8, 40.6, 40.5, 40.4, 40.4, 40.3, 40.2, 39.9, 39.9, 39.8,
  39.7, 39.6, 39.6, 39.5, 39.4, 39.3, 38.9, 38.9, 38.8, 38.8,
  38.7, 38.7, 38.6, 38.6, 38.5, 38.4, 38.3, 38.2, 38.1, 38.1,
  37.6, 37.4, 37.1, 37.8, 37.6, 37.5, 37.4, 37.3, 37.2, 37.1,
  37.1, 36.6, 36.5, 36.5, 36.4, 36.3, 36.2, 36.1, 35.4, 35.3,
  35.2, 35.1, 35.1, 34.7, 34.3, 34.2, 33.2, 33.1, 32.7, 31.5
)
B <- c(
  47.3, 46.1, 45.6, 45.1, 44.5, 44.4, 43.7, 42.6, 42.5, 42.5,
  41.4, 41.8, 41.6, 41.5, 40.7, 40.5, 40.4, 40.3, 40.1, 40.1,
  39.9, 39.8, 39.7, 39.6, 39.6, 39.5, 39.4, 38.9, 38.8, 38.8,
  38.7, 38.7, 38.6, 38.4, 38.2, 38.1, 38.1, 37.8, 37.7, 37.5,
  37.5, 37.4, 37.3, 37.3, 37.1, 36.8, 36.8, 36.7, 36.6, 36.4,
  36.2, 35.4, 35.4, 35.4, 35.3, 35.2, 34.9, 34.8, 34.7, 34.7,
  33.9, 33.8, 33.7, 33.3, 33.1, 32.8, 32.5, 32.1, 31.7, 29.5
)
df2 <- data.frame(
  values = c(A, B),
  labels = c(rep("SchoolA", length(A)), rep("SchoolB", length(B)))
)
ggplot(df2) +
  facet_wrap(. ~ labels) +
  geom_histogram(aes(x = values))
```

### 2.2.1 中心や位置を表す指標

平均値を $\bar{X}=1/n = \Sigma_{i=1}^{n}X_i$ としています。
人によてはRのコードで見たほうが理解しやすいかもしれません。
`X_A_bar`($\bar{X}_A$) は以下のように求められます。

```{r}
# ベクトルに対して一度に真偽値を求められる
print(df2$labels=="SchoolA")
# [行,列]を真偽値で指定できる。
print(df2[df2$labels=="SchoolA",])
X_A = df2[df2$labels=="SchoolA", "values"]
X_A_bar = sum(X_A)/length(X_A)
X_A_bar
```

課題: `X_B_bar` を求めてみてください。

```{r}
# X_B_bar
```

その他、中央値や最頻値もありますが統計ではあまり使いません。
Rなら箱ひげ図も簡単に描けます。

```{r}
ggplot(df2) +
  geom_boxplot(aes(x = labels, y=values))
```

### 2.2.2 ばらつきを表す指標

標本分散は小さい方向へ偏るので、
1/n ではなく 1/(n-1) をかけて偏りをなくす
（より大きい、偏るのない「不偏」な分散とする）
コラム2.3を参照したい。

```{r}
X_A = df1[df1$labels=="SampleA", "values"]
n = length(X_A)
# 偏差和
sum(X_A - mean(X_A))  # ほぼ0
# 平方和(ただし、データの数だけ増えるし、単位が面積になっている)
sum((X_A - mean(X_A))^2)  # 式(2.2)
# 標本分散(まだ単位は面積)
sum((X_A - mean(X_A))^2)/(n-1)
# 標準偏差(平均的なばらつき)
sqrt(sum((X_A - mean(X_A))^2)/(n-1))
sd(X_A) == sqrt(sum((X_A - mean(X_A))^2)/(n-1))  # Rのsdはn-1バージョン
```

このsdの値は色々なところに使える。値が正規分布に従うとき、
+-2sdは95%になる。

ちゃんともとのグラフのばらつき具合を反映できていることを確認する