---
title: "母集団と標本"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ch02.md の目標

- 用語を整理する(母集団と標本, 無作為抽出, 母平均$\mu$と母分散$\sigma^2$)
  - 母集団から標本を無作為抽出 -> (母分散を推定) -> 母平均の幅を推定
- 

## 2.1 母集団と標本の関係

- 統計の目的: **母集団**の性質（**母平均**、**母分散**）を**標本**から**推定**
- 記号の意味の説明(わからない値はギリシャ文字に置かれがち)
  - 母平均を$\mu$、母分散を $\sigma^2$
  - 標本平均を $\bar{X}$、標本分散を $s^2$
- 無作為抽出: 標本を母集団からランダムに抽出

## 2.2 標本の性質

p.13以降は徐々に数式が増えていくのでRのコードで補足.

```{r}
# p.13 のデータ
# <- で変数に10の数値を代入、cはconcatenateのc
A <- c(3, 4, 4, 5, 5, 5, 5, 6, 6, 7)
B <- c(1, 2, 4, 4, 5, 5, 5, 6, 8, 10)
# repはrepeat
# 問: rep("SampleA", 10) の意味は...?
df1 <- data.frame(
  values = c(A, B),
  labels = c(rep("SampleA", 10), rep("SampleB", 10))
)
```

※作成した環境にコピペして動かしてみましょう。

## 2.2 標本の性質

最初の行を見る関数(機能)

```{r}
# 最初の6行を見せて、という意味
head(df1, 6)
```

## 2.2 標本の性質

```{r, fig.height=3, message=FALSE}
library(ggplot2)  # 可視化
# SampleAもSampleBも5あたりに中心があるけれど、
# ばらつきはSampleBの方が大きいですね。
ggplot(df1) +
  facet_wrap(. ~ labels) +
  geom_histogram(aes(x = values))
```

## 2.2 標本の性質

```{r}
# https://whatalnk.github.io/stat-intro-by-r-tkd/Chap02.html
A <- c(
  43.3, 43.1, 42.6, 42.4, 42.2, 41.8, 41.7, 41.6, 41.5, 41.4,
  40.8, 40.6, 40.5, 40.4, 40.4, 40.3, 40.2, 39.9, 39.9, 39.8,
  39.7, 39.6, 39.6, 39.5, 39.4, 39.3, 38.9, 38.9, 38.8, 38.8,
  38.7, 38.7, 38.6, 38.6, 38.5, 38.4, 38.3, 38.2, 38.1, 38.1,
  37.6, 37.4, 37.1, 37.8, 37.6, 37.5, 37.4, 37.3, 37.2, 37.1,
  37.1, 36.6, 36.5, 36.5, 36.4, 36.3, 36.2, 36.1, 35.4, 35.3,
  35.2, 35.1, 35.1, 34.7, 34.3, 34.2, 33.2, 33.1, 32.7, 31.5
)
```

## 2.2 標本の性質

```{r}
# https://whatalnk.github.io/stat-intro-by-r-tkd/Chap02.html
B <- c(
  47.3, 46.1, 45.6, 45.1, 44.5, 44.4, 43.7, 42.6, 42.5, 42.5,
  41.4, 41.8, 41.6, 41.5, 40.7, 40.5, 40.4, 40.3, 40.1, 40.1,
  39.9, 39.8, 39.7, 39.6, 39.6, 39.5, 39.4, 38.9, 38.8, 38.8,
  38.7, 38.7, 38.6, 38.4, 38.2, 38.1, 38.1, 37.8, 37.7, 37.5,
  37.5, 37.4, 37.3, 37.3, 37.1, 36.8, 36.8, 36.7, 36.6, 36.4,
  36.2, 35.4, 35.4, 35.4, 35.3, 35.2, 34.9, 34.8, 34.7, 34.7,
  33.9, 33.8, 33.7, 33.3, 33.1, 32.8, 32.5, 32.1, 31.7, 29.5
)
```

## 2.2 標本の性質

```{r echo=TRUE, message=FALSE, warning=FALSE, fig.height=3}
df2 <- data.frame(
  values = c(A, B),
  labels = c(rep("SchoolA", length(A)), rep("SchoolB", length(B)))
)
ggplot(df2) +
  facet_wrap(. ~ labels) +
  geom_histogram(aes(x = values))
```

## 2.2.1 中心や位置を表す指標

平均値を $\bar{X}=1/n\Sigma_{i=1}^{n}X_i$ としています。
人によっては下のRコードで見たほうが理解しやすいかもしれません。
`X_A_bar`($\bar{X}_A$) は以下のように求められます。

```{r}
X_A_bar = sum(A)/length(A)
X_A_bar
# 課題: `X_B_bar` を求めてみてください。
```

中央値や最頻値は飛ばします。なお、繰り返しになりますが
母平均は$\mu$、標本平均は$\bar{X}$としています。

## 2.2.1 中心や位置を表す指標

```{r}
# X_B_bar
print(df2$labels=="SchoolB")
# [行,列]を真偽値で指定できる。
print(df2[df2$labels=="SchoolA",])
X_A = df2[df2$labels=="SchoolA", "values"]
X_A_bar = sum(X_A)/length(X_A)
X_A_bar
```

- Rとベクトルの計算

```{r}
B <- c(1, 2, 4, 4, 5, 5, 5, 6, 8, 10)
sqrt(sum((mean(B) - B)^2)/9)
sd(B)

data = c(5.1, 7.4, 10.3, 9.2, 6.5, 6.1, 7.9, 8.4, 8.1, 9.4)
# 2.1
sqrt(var(data)) == sd(data)
sd(data)

# 2.2
n = length(data)
d.mean = sum(data)/n
d.mean

sqrt(sum((d.mean - data)^2) / (n-1))
```

その他、中央値や最頻値もありますが統計ではあまり使いません。
Rなら箱ひげ図も簡単に描けます。

```{r}
ggplot(df2) +
  geom_boxplot(aes(x = labels, y=values))
```

### 2.2.2 ばらつきを表す指標

<!-- 2012 年度の高 1 生より，データの分析(統計学) が必修単位として導入された -->
<!-- 高校はクラス間の比較などの全数調査になっている。不偏分散が新しい -->

標本分散は小さい方向へ偏るので、
1/n ではなく 1/(n-1) をかけて偏りをなくす
（より大きい、偏るのない「不偏」な分散とする）
コラム2.3を参照したい。

```{r}
X_A = df1[df1$labels=="SampleA", "values"]
n = length(X_A)
# 偏差和
sum(X_A - mean(X_A))  # ほぼ0
# 平方和(ただし、データの数だけ増えるし、単位が面積になっている)
sum((X_A - mean(X_A))^2)  # 式(2.2)
# 標本分散(まだ単位は面積)
sum((X_A - mean(X_A))^2)/(n-1)
# 標準偏差(平均的なばらつき)
sqrt(sum((X_A - mean(X_A))^2)/(n-1))
sd(X_A) == sqrt(sum((X_A - mean(X_A))^2)/(n-1))  # Rのsdはn-1バージョン
```

このsdの値は色々なところに使える。値が正規分布に従うとき、
+-2sdは95%になる。

ちゃんともとのグラフのばらつき具合を反映できていることを確認する

## 2.3 演習問題

R初出
